# @restroom-mw/db

Is a basic middleware to make basic operations on a database.

Uses [sequelize ORM](https://sequelize.org/) underneath, so accepts the same dialects and supports Postgres, MySQL, MariaDB, SQLite and Microsoft SQL Server.

Interpretes the [actions](#actions) to connect to a database, select some value and put into the `DATA` of zenroom and save the result into a the `result` table.

## Usage

```js
import express from "express";
import zencode from "@restroom-mw/core";
import db from "@restroom-mw/db";

const app = express();

app.use(db);
app.use("/api/*", zencode);
```

## Database Setup

To use MySQL, you first need to format a table, with 4 columns, as in the picture:

![](.././images/mysql-db-setup.png)

You can use this code to create the table:

```sql
CREATE TABLE `myTable` (
  `id` int(11) NOT NULL,
  `result` text,
  `createdAt` datetime NOT NULL,
  `updatedAt` datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
```

## Zencode examples

The syntax of the actions is [here](https://github.com/dyne/restroom-mw/blob/master/packages/db/src/index.ts#L9-L16).

### Write data to a MySQL database

Use this **Zencode**:

```gherkin
# Here we are loading the name of the table we are writing on, 
# and the URI of the mysql database
# Here we're using a free database from remotemysql.com
Given I have a database uri named 'mysql'
Given I have a database table named 'myTable'

# Here we create an array, just for fun
When I create the array of '8' random objects of '256' bits

# Here we print the output that we want to be stonred in the table.
# If you don't print the output, restroom-mw won't save it in the database
Then print all data

# Here we are asking restroom-mw to store what has just been printed out, into the database
Then I save the 'array' into the database 'mysql' into the table 'myTable'
```

With this **keys**:

```json
{
	"myTable": "firstTable",
	"mysql": "mysql://48Dg7xv6YL:nz6usNgiD1@remotemysql.com:3306/48Dg7xv6YL"
}
```

### Read data to a MySQL database

Use this **Zencode**:

```gherkin
# Here we are loading the name of the table we are writing on, 
# and the URI of the mysql database
# Here we're using a free database from remotemysql.com
Given I have a database uri named 'mysql'
Given I have a database table named 'myTable'

# here we are telling Zenroom to 'allocate' a string dictionary, that 
# we'll use to store the data read from the database
Given I have a 'string dictionary' named 'myResult'

# Here we are reading the record with id '2' of the table and database we declared before
Given I read the record '2' of the table 'myTable' of the database 'mysql' and save the result into 'myResult'

# the value of the record could be 0 to max could be 

Then print 'myResult'
```

With this **keys**:

```json
{
	"myTable": "firstTable",
	"myCache": "firstCache",
	"mysql": "mysql://48Dg7xv6YL:nz6usNgiD1@remotemysql.com:3306/48Dg7xv6YL"
}
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents
